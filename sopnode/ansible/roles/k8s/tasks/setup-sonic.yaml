---
- name: Check if OS is SONiC
  stat:
    path: /etc/sonic/sonic_release
  register: is_SONiC_os

- name: install stuff
  block:

  - name: Load kernel modules
    community.general.modprobe:
      name: '{{ item }}'
      state: present
    with_items: "{{ kernel.modules }}"

  - name: Set kernel attributes
    ansible.posix.sysctl:
      name: '{{ item.option }}'
      value: '{{ item.value }}'
      sysctl_set: yes
      state: present
      reload: yes
    with_items: "{{ kernel.attributes }}"

  when: is_SONiC_os.stat.exists

